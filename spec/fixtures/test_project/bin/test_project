# encoding: utf-8

$: << File.expand_path('../../lib', __FILE__)

require 'humboldt'

require 'distributed_cache_test'
require 'combined_text_test'

Rubydoop.run do |input_path, output_path|
  job 'test distributed cache' do
    input "#{input_path}/cache"
    output "#{output_path}/cache"

    cache_file File.expand_path("cached_files/super_important_file.doc", ENV['HUMBOLDT_TEST_PROJECT_PATH']), :as => 'important.doc'
    cache_file File.expand_path("cached_files/another_file", ENV['HUMBOLDT_TEST_PROJECT_PATH']), :as => 'another_file'

    mapper DistributedCacheTest::Mapper
    reducer DistributedCacheTest::Reducer
  end

  job 'test combined text input' do
    input "#{input_path}/combined_text", format: :combined_text
    set 'mapreduce.input.fileinputformat.split.maxsize', 32 * (1024 ** 2)

    output "#{output_path}/combined_text"

    mapper CombinedTextTest::Mapper
    reducer CombinedTextTest::Reducer
  end
end

